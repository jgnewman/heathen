#!/usr/bin/env node


var fs       = require('fs'),
    argParse = require('../src/argparser').parse,
    version  = require('../src/compiletechniques').version,
    api      = require('../heathen'),
    bashArgs = process.argv.slice(2),
    usage    = [
        ""
      , "  Usage: heathen [input] [options]"
      , ""
      , "  Input: The path to the file containing Heathen code."
      , ""
      , "  Options:"
      , ""
      , "    -v, --version          Display the version of heathen."
      , "    -h, --help             Display help information."
      , "    -o, --output [file]    The path to the file where you want to place compiled code."
      , "    -m, --minify"
      , ""
    ].join("\n"),
    args;

/*
 * Define an example procedure that can be called in case
 * of the right arguments.
 */
function processOptions(argObj) {
  var options = {};

  if (args._noflag) {
    options.input = args._noflag[0];
  }
  if (args['-o']) {
    options.output = args['-o'][0];
  }
  if (args['-m']) {
    options.minify = true;
  }

  return api.compile(options);
}

/*
 * Parse arguments that came in from the command line.
 * See lib/argparser.js for usage details.
 */
args = argParse(bashArgs, [
  ["-v", "--version"],
  ["-h", "--help"],
  ["-o", "--output"]
]);

/*
 * Determine what to do based on the arguments we have.
 */
if (args["-v"]) {
  console.log(version);
  process.exit(0);

} else if (args["-h"]) {
  console.log(usage);
  process.exit(0);

} else {
  processOptions(args);
}
